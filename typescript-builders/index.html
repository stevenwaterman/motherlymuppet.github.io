<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta
			name="description"
			content="I'm a software developer, technical coach, over-analyser. This is where I do those things. Mostly over-analysing."
		/>
		<link rel="icon" href="/favicon.png" />
		<link rel="stylesheet" href="/global.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta http-equiv="content-security-policy" content=""><title>TypeScript Builders: Improving your types one step at a time</title><meta name="description" content="We can use builders to implement complex type constraints in TypeScript, giving us compile-time errors when we make a semantic error, rather than just syntactic errors."><link rel="alternate" type="application/rss+xml" href="https://stevenwaterman.uk/rss.xml" title="Steven Waterman's Blog"><link rel="canonical" href="https://stevenwaterman.uk/typescript-builders"><meta property="og:title" content="TypeScript Builders: Improving your types one step at a time"><meta property="og:description" content="We can use builders to implement complex type constraints in TypeScript, giving us compile-time errors when we make a semantic error, rather than just syntactic errors."><meta property="og:image" content="https://stevenwaterman.uk/assets/blog/typescript-builders/header.png"><meta property="og:type" content="article"><meta property="og:site_name" content="Steven Waterman"><meta property="og:url" content="https://stevenwaterman.uk/typescript-builders"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@SteWaterman"><meta name="twitter:image" content="https://stevenwaterman.uk/assets/blog/typescript-builders/header.png"><meta name="twitter:creator" content="@SteWaterman">
	<link rel="stylesheet" href="/_app/assets/vendor-ec9510ad.css">
	<link rel="stylesheet" href="/_app/assets/pages/typescript-builders/index.svelte-1605d221.css">
	<link rel="stylesheet" href="/_app/assets/BlogPost-27f41e79.css">
	<link rel="stylesheet" href="/_app/assets/Template-8f63f35a.css">
	<link rel="stylesheet" href="/_app/assets/Snippet-1ad9e017.css">
	</head>
	<body>
		






<div class="gradient svelte-1thle15"><div class="panX svelte-1atbztl"><div class="panY svelte-1atbztl"><div class="gradient svelte-1atbztl"></div></div></div></div>

<nav class="svelte-1nxg8xt"><a class="logoLink svelte-1nxg8xt" href="/"><img class="logo svelte-1nxg8xt" src="/assets/logoWhite.svg" alt="Logo">
		<span class="logoText svelte-1nxg8xt">SW</span></a>

	<div class="burgerMenuContainer svelte-1nxg8xt"><span tabindex="0" class="burgerMenuOpen svelte-1nxg8xt"><svg id="" class="svelte-fa svelte-1cj2gr0" style="height:1em;vertical-align:-.125em;transform-origin:center;overflow:visible" viewBox="0 0 448 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(224 256)" transform-origin="112 0"><g transform="translate(0,0) scale(1,1)"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z" fill="currentColor" transform="translate(-224 -256)"></path></g></g></svg></span>

		<ul class="menu svelte-1nxg8xt"><li class="svelte-1nxg8xt"><span class="label svelte-101pjyx"><a class="topLink svelte-101pjyx" href="/">Blog</a>
  </span></li>

			<li class="svelte-1nxg8xt"><span class="label svelte-101pjyx"><a class="topLink svelte-101pjyx" href="/assets/cv.pdf">CV</a>
  </span></li>

			<li class="svelte-1nxg8xt"><span class="label svelte-101pjyx"><a class="topLink svelte-101pjyx">Socials</a>
  <div class="menu svelte-101pjyx"><div class="menu-arrow svelte-101pjyx"><div class="menu-arrow-fill svelte-101pjyx"></div></div>
      <div class="menu-content svelte-101pjyx"><ul class="svelte-101pjyx"><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://twitter.com/SteWaterman/">Twitter</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://github.com/StevenWaterman/">GitHub</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://www.linkedin.com/in/steven-waterman/">LinkedIn</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://twitch.tv/SteWaterman/">Twitch</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="mailto:website@stevenwaterman.uk">Email</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://calendly.com/stewaterman/30min">Calendly</a>
            </li></ul></div></div></span></li>

			<li class="svelte-1nxg8xt"><span class="label svelte-101pjyx"><a class="topLink svelte-101pjyx" href="/#community">Projects</a>
  <div class="menu svelte-101pjyx"><div class="menu-arrow svelte-101pjyx"><div class="menu-arrow-fill svelte-101pjyx"></div></div>
      <div class="menu-content svelte-101pjyx"><ul class="svelte-101pjyx"><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://tunescape07.com">TuneScape</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://stevenwaterman.uk/Balance/">Balance Scores</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://lexoral.com">Lexoral</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://stevenwaterman.uk/musetree/">MuseTree</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://stevenwaterman.uk/NoTimeToStalk">No Time to Stalk</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://github.com/stevenwaterman/narration.studio">Narration.Studio</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://stevenwaterman.uk/Spiro/">Spiro</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://linktr.ee/prevoid_art">Art</a>
            </li><li class="menuEntry svelte-101pjyx"><a class="menuLink svelte-101pjyx" href="https://soundcloud.com/user-872603169">Music</a>
            </li></ul></div></div></span></li>

			<li class="chat svelte-1nxg8xt"><div class="container svelte-1atmfra">
  <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
  <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
  <button onclick="Calendly.initPopupWidget({url: &#39;https://calendly.com/stewaterman/30min&#39;});return false;" class="svelte-1atmfra">Let&#39;sÂ Chat<span class="arrow svelte-1atmfra">&gt;</span></button>
  </div></li></ul></div>
</nav>

<div class="column svelte-1thle15"><div class="grid svelte-1quqrs0"><div class="textContainer svelte-11sshxl" style=""><article><a href="/assets/blog/typescript-builders/header.png"><img class="headerImage svelte-1quqrs0" src="/assets/blog/typescript-builders/header.png" style="object-fit: cover; object-position: center;" alt="Header"></a>
				<div class="padded svelte-1quqrs0"><div class="metadata svelte-1quqrs0"><p class="type svelte-1quqrs0">technical</p>
						<p class="date svelte-1quqrs0">Published <time>2020-09-16</time></p>
						<p class="author svelte-1quqrs0">By Steven Waterman</p></div>

					<h1 class="svelte-1quqrs0">TypeScript Builders: Improving your types one step at a time</h1>

					<div class="topSection svelte-1quqrs0"><div class="left"><summary class="svelte-1quqrs0">We can use builders to implement complex type constraints in TypeScript, giving us compile-time errors when we make a semantic error, rather than just syntactic errors.</summary>

							<p class="original svelte-1quqrs0">Originally posted on <a href="https://blog.scottlogic.com/2020/09/16/typescript-builders.html">the Scott Logic blog</a></p>

							</div>

						</div>

					<hr class="svelte-1quqrs0">

					<p>The builder pattern in TypeScript is amazing.
    However, the way you use it in TypeScript is completely different to other languages.
    Typically, builders are used to add support for optional and default parameters in languages that don&#39;t support them directly.
    TypeScript <em>already</em> supports <a href="https://www.typescriptlang.org/docs/handbook/functions.html#optional-and-default-parameters">optional and default parameters</a> though - so what&#39;s the point?
  </p>

  <p>We can actually use builders as a workaround for other issues in the type system.
    In TypeScript, that means a way to enforce complex constraints like <code>only allow sending an event if anyone is listening for that event</code>.
    In this (long but beginner-friendly) post, we do an in-depth walkthrough of how to create a TypeScript builder class to enforce a complex constraint like that one.
  </p>

  <p>We start by introducing a simple data processing task and discuss how it would be useful to create a generic version.
    That immediately gets too hard, so we introduce builders to save the day.
    Step-by-step, we analyse the problem and design a builder to solve the problem.
    We then discuss the pros and cons of that approach, and explore whether it was even necessary in the first place.
  </p>

  <h2>A Simple Task</h2>

  <p>Let&#39;s imagine a basic data processing task:
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Simple-Pipeline.svg" title="This definitely warranted a 5000 word blog post" alt="Shows a simple data pipeline that performs the following steps:" class="svelte-1wsp3u5"></figure>

  <ol><li>Take an integer string as input</li>
    <li>Reverse it</li>
    <li>Parse it back into an integer</li>
    <li>Multiply it by 5</li></ol>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Basic</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> input = <span class="hljs-string">&quot;524&quot;</span>;</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> a = input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> b = <span class="hljs-built_in">parseInt</span>(input, <span class="hljs-number">10</span>);</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> c = b * <span class="hljs-number">5</span>;</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> input = <span class="hljs-string">&quot;524&quot;</span>;
<span class="hljs-keyword">const</span> a = input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);
<span class="hljs-keyword">const</span> b = <span class="hljs-built_in">parseInt</span>(input, <span class="hljs-number">10</span>);
<span class="hljs-keyword">const</span> c = b * <span class="hljs-number">5</span>;</code>
</figure>

  <p>The rest of this blog post is dedicated to over-engineering that tiny bit of code.
    It&#39;s clearly overkill in this case, but that&#39;s inevitable when we use a simple example to demonstrate an advanced technique.
  </p>

  <h3>Making it Reusable</h3>

  <p>We saw how to do that task as a one-off, but what if we wanted it to be a configurable reusable function?
    We can define a function that takes a few config parameters:
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Configurable-Pipeline.svg" title="Not that you'd ever really want to set the radix" alt="The to Int and multiply steps take config parameters now" class="svelte-1wsp3u5"></figure>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Reusable</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true"><details class="svelte-19djgjm"><summary class="svelte-19djgjm">&lt;Show 7 identical lines&gt;</summary>
    <div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, radix: <span class="hljs-built_in">number</span>, multiplicand: <span class="hljs-built_in">number</span></span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> a = input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> b = <span class="hljs-built_in">parseInt</span>(input, radix);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> c = b * multiplicand;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> c;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-title function_">process</span>(<span class="hljs-string">&quot;524&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>);</div></details>

<div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, radix: <span class="hljs-built_in">number</span>, multiplicand: <span class="hljs-built_in">number</span></span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> a = input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> b = <span class="hljs-built_in">parseInt</span>(input, radix);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> c = b * multiplicand;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> c;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-title function_">process</span>(<span class="hljs-string">&quot;524&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, radix: <span class="hljs-built_in">number</span>, multiplicand: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">const</span> a = input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);
  <span class="hljs-keyword">const</span> b = <span class="hljs-built_in">parseInt</span>(input, radix);
  <span class="hljs-keyword">const</span> c = b * multiplicand;
  <span class="hljs-keyword">return</span> c;
}
<span class="hljs-title function_">process</span>(<span class="hljs-string">&quot;524&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>);</code>
</figure>

  <p>Often, it&#39;s easier to take the config as a single object:
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Config-Object.svg" title="We're definitely doing it this way because it's intuitive and not because it makes the rest of the blog post simpler" alt="The radix and multiplicand parameters come from a single config object" class="svelte-1wsp3u5"></figure>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Single Object Config</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true"><details class="svelte-19djgjm"><summary class="svelte-19djgjm">&lt;Show 7 identical lines&gt;</summary>
    <div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, radix: <span class="hljs-built_in">number</span>, multiplicand: <span class="hljs-built_in">number</span></span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> a = input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> b = <span class="hljs-built_in">parseInt</span>(input, radix);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> c = b * multiplicand;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> c;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-title function_">process</span>(<span class="hljs-string">&quot;524&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>);</div></details>

<div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, radix: <span class="hljs-built_in">number</span>, multiplicand: <span class="hljs-built_in">number</span></span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> a = input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> b = <span class="hljs-built_in">parseInt</span>(input, radix);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">const</span> c = b * multiplicand;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> c;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-title function_">process</span>(<span class="hljs-string">&quot;524&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, radix: <span class="hljs-built_in">number</span>, multiplicand: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">const</span> a = input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);
  <span class="hljs-keyword">const</span> b = <span class="hljs-built_in">parseInt</span>(input, radix);
  <span class="hljs-keyword">const</span> c = b * multiplicand;
  <span class="hljs-keyword">return</span> c;
}
<span class="hljs-title function_">process</span>(<span class="hljs-string">&quot;524&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>);</code>
</figure>

  <p>That&#39;s useful as it allows the config to be loaded from a JSON file.
    <em>Conveniently</em> it also makes our job easier later on.
    What are the odds?
  </p>

  <h3>Formal Definition</h3>

  <p>Taking a step back, what is it that we&#39;re actually trying to do?
  </p>

  <p>This pattern is really common, and goes by a few names.
    Most commonly in computing, it&#39;s known as a <a href="https://en.wikipedia.org/wiki/Pipeline_(computing)">pipeline</a> - a function which takes data and performs a sequence of transformations.
    The fundamental technique in mathematics is called <a href="https://en.wikipedia.org/wiki/Function_composition">function composition</a> - combining many small functions into one larger function.
  </p>

  <p>Pipelines are used for things like application build config, or for http request middleware.
    Their main benefit is the ability to <em>encapsulate</em> many functions, allowing them to be treated as one.
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Encapsulation.svg" title="All good technical diagrams include a red scribble" alt="We can treat the entire pipeline as a single function" class="svelte-1wsp3u5"></figure>

  <h3>A Pipeline Factory</h3>

  <p>Since we create pipelines so often, a reusable function that creates pipelines sounds really useful.
    The JavaScript implementation is simple using higher-order functions:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Pipeline Factory</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true"><details class="svelte-19djgjm"><summary class="svelte-19djgjm">&lt;Show 13 identical lines&gt;</summary>
    <div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createPipeline</span>(<span class="hljs-params">functions</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">pipeline</span>(<span class="hljs-params">initState, config</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">let</span> state = initState;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">for</span> (func <span class="hljs-keyword">of</span> functions) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="code hidden svelte-19djgjm">      state = <span class="hljs-title function_">func</span>(state, config);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="code hidden svelte-19djgjm">    }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> state;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="code hidden svelte-19djgjm">  };</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">11</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">11</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-comment">// Or as a long one-liner:</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">12</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">12</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createPipeline</span> = (<span class="hljs-params">initState</span>) =&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">13</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">13</div>
        <div class="code hidden svelte-19djgjm">  functions.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">state, func</span>) =&gt;</span> <span class="hljs-title function_">func</span>(state, config), initState);</div></details>

<div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createPipeline</span>(<span class="hljs-params">functions</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">pipeline</span>(<span class="hljs-params">initState, config</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">let</span> state = initState;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">for</span> (func <span class="hljs-keyword">of</span> functions) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code hidden svelte-19djgjm">      state = <span class="hljs-title function_">func</span>(state, config);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="code hidden svelte-19djgjm">    }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> state;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="code hidden svelte-19djgjm">  };</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">11</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">11</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-comment">// Or as a long one-liner:</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">12</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">12</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createPipeline</span> = (<span class="hljs-params">initState</span>) =&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">13</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">13</div>
  <div class="code hidden svelte-19djgjm">  functions.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">state, func</span>) =&gt;</span> <span class="hljs-title function_">func</span>(state, config), initState);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createPipeline</span>(<span class="hljs-params">functions</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">pipeline</span>(<span class="hljs-params">initState, config</span>) {
    <span class="hljs-keyword">let</span> state = initState;
    <span class="hljs-keyword">for</span> (func <span class="hljs-keyword">of</span> functions) {
      state = <span class="hljs-title function_">func</span>(state, config);
    }
    <span class="hljs-keyword">return</span> state;
  };
}

<span class="hljs-comment">// Or as a long one-liner:</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createPipeline</span> = (<span class="hljs-params">initState</span>) =&gt;
  functions.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">state, func</span>) =&gt;</span> <span class="hljs-title function_">func</span>(state, config), initState);</code>
</figure>

  <figure><img src="/assets/blog/typescript-builders/Builders-Factory.svg" title="If only it was that easy" alt="We pass the three functions as a list into the pipeline factory, which outputs the factory" class="svelte-1wsp3u5"></figure>

  <p>However, just because the JS code is simple, that doesn&#39;t mean it&#39;s easy to do (safely) in TypeScript.
    Of course, it&#39;s possible to just copy the JavaScript with a healthy sprinkling of <code>any</code>.
  </p>

  <p>That&#39;s no fun though - why even use TypeScript if you&#39;re just gonna ignore type errors?
    Let&#39;s try actually putting in some effort, and see how narrow we can make the types.
    As a first attempt, I get something like this:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Trying TypeScript</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">function</span> createPipeline&lt;<span class="hljs-title class_">Type</span>, <span class="hljs-title class_">Config</span>&gt;(</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-attr">functions</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">input: Type, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Type</span>&gt;</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">): <span class="hljs-function">(<span class="hljs-params">input: Type, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Type</span> {}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> createPipeline&lt;<span class="hljs-title class_">Type</span>, <span class="hljs-title class_">Config</span>&gt;(
  <span class="hljs-attr">functions</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">input: Type, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Type</span>&gt;
): <span class="hljs-function">(<span class="hljs-params">input: Type, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Type</span> {}</code>
</figure>

  <p>This has issues.
    To find out why, we need to learn some new terminology.
  </p>

  <h3>Math Time</h3>

  <p>It&#39;s time for a quick journey into the foundations of mathematical logic, so hold onâ¦
  </p>

  <hr>

  <p>Ideally, we want a type definition to be <em>sound</em> and <em>complete</em>.
    <em>Soundness</em> means any function call that compiles will not cause type errors at runtime.
    <em>Completeness</em> means any valid function call should compile.
  </p>

  <p>Mathematicians have <a href="https://en.wikipedia.org/wiki/Soundness">much longer</a>, <a href="https://en.wikipedia.org/wiki/Completeness_(logic)">more general</a> definitions of those terms.
  </p>

  <p>Our first Pipeline Factory attempt is <em>sound</em> but not <em>complete</em>.
    It requires all the functions to be the same type.
    The JavaScript version is more powerful.
  </p>

  <p>The pipeline we created manually contains three stages.
    Some of them output a string, while others output a number.
    That&#39;s fine in our JS example, but won&#39;t compile in our TS example.
  </p>

  <p>Specifically, a pipeline is valid when each stage&#39;s output is the same type as the next stage&#39;s input.
    To achieve both soundness and completeness, we&#39;d need a way to check for that.
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Constraint.svg" title="The outie bit needs to fit the innie bit. That's just how science works." alt="Each stage has a shaped input and output. They must match up like a jigsaw if the pipeline is going to work" class="svelte-1wsp3u5"></figure>

  <p>It&#39;s not obvious how we could achieve both soundness and completeness at the same time.
    Any simple solutions will only achieve completeness by losing soundness, like this:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Completeness</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">function</span> createPipeline&lt;<span class="hljs-title class_">Config</span>&gt;(</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-attr">functions</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">input: <span class="hljs-built_in">any</span>, config: Config</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">): <span class="hljs-function">(<span class="hljs-params">input: <span class="hljs-built_in">any</span>, config: Config</span>) =&gt;</span> <span class="hljs-built_in">any</span> {</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-comment">/*...*/</span></div><div class="fromLine same svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code same svelte-19djgjm">}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> createPipeline&lt;<span class="hljs-title class_">Config</span>&gt;(
  <span class="hljs-attr">functions</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">input: <span class="hljs-built_in">any</span>, config: Config</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;
): <span class="hljs-function">(<span class="hljs-params">input: <span class="hljs-built_in">any</span>, config: Config</span>) =&gt;</span> <span class="hljs-built_in">any</span> {
  <span class="hljs-comment">/*...*/</span>
}</code>
</figure>

  <p>In other words, this would let us pass an invalid pipeline, like this:
  </p>

  <ol><li>Take a string and reverse it</li>
    <li>Multiply by 5</li></ol>

  <p>In step 1, we output a string, but in step 2 we expect a number as an input.
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Constraint-Error.svg" title="It's like when you get a box that's half full of Lego and half MegaBlocks..." alt="The output of reverse doesn't fit the input of multiply" class="svelte-1wsp3u5"></figure>

  <hr>

  <p>Right, we&#39;re out of the woods now.
    Still with me?
    Let&#39;s get back to the code.
  </p>

  <h3>The problem</h3>

  <p>Our ideal pipeline definition is too complex.
    A pipeline is valid based on whether each element in an array matches the one before it.
    That&#39;s not something we can easily restrict.
  </p>

  <p>With builders, it&#39;s a different picture entirely.
  </p>

  <h2>Introducing Builders</h2>

  <p>A <a href="https://en.wikipedia.org/wiki/Builder_pattern">builder</a> is any utility class that uses sequential method calls to have the effect of a single method call.
    They are typically used for the creation of complex objects.
    For example, a string concatenation function could be written as:
  </p>
  
  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Concatenation Function</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">concat</span>(<span class="hljs-params">...sections: <span class="hljs-built_in">string</span>[]</span>): <span class="hljs-built_in">string</span> {}</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> output = <span class="hljs-title function_">concat</span>(<span class="hljs-string">&quot;hi&quot;</span>, <span class="hljs-string">&quot;my&quot;</span>, <span class="hljs-string">&quot;pals&quot;</span>);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> <span class="hljs-title function_">concat</span>(<span class="hljs-params">...sections: <span class="hljs-built_in">string</span>[]</span>): <span class="hljs-built_in">string</span> {}
<span class="hljs-keyword">const</span> output = <span class="hljs-title function_">concat</span>(<span class="hljs-string">&quot;hi&quot;</span>, <span class="hljs-string">&quot;my&quot;</span>, <span class="hljs-string">&quot;pals&quot;</span>);</code>
</figure>

  <figure><img src="/assets/blog/typescript-builders/Builders-String-Factory.svg" title="ARGH I FORGOT THE SPACES!!!" alt="A simple function that takes a list of strings and joins them together" class="svelte-1wsp3u5"></figure>

  <p>Or it could be written as a builder, meaning it gets used like this:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Concatenation Builder</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> output = <span class="hljs-title class_">StringBuilder</span>.<span class="hljs-title function_">new</span>()</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;Hi&quot;</span>)</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">  .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;my&quot;</span>)</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code same svelte-19djgjm">  .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;pals&quot;</span>)</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code same svelte-19djgjm">  .<span class="hljs-title function_">build</span>();</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> output = <span class="hljs-title class_">StringBuilder</span>.<span class="hljs-title function_">new</span>()
  .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;Hi&quot;</span>)
  .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;my&quot;</span>)
  .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;pals&quot;</span>)
  .<span class="hljs-title function_">build</span>();</code>
</figure>
  
  <figure><img src="/assets/blog/typescript-builders/Builders-String-Builder.svg" title="This is definitely much easier :|" alt="Achieves the same thing but using repeated append calls on a builder" class="svelte-1wsp3u5"></figure>

  <p><code>StringBuilder</code> isn&#39;t something we see very often in TypeScript, because it&#39;s easy enough to just write it as a single method as seen above.
    In Java however, we see builders all the time (<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/StringBuilder.html">including <code>StringBuilder</code></a>).
    That&#39;s because Java&#39;s type system is less flexible than TypeScript&#39;s.
  </p>

  <blockquote>Builders make up for inadequacies in the type system
  </blockquote>

  <p>In Java, they let us call functions with a varying number of arguments, and provide a way to support optional and default parameters.
    TypeScript already supports <a href="https://www.typescriptlang.org/docs/handbook/functions.html#optional-and-default-parameters">all</a> of <a href="https://www.typescriptlang.org/docs/handbook/functions.html#rest-parameters">that</a>, but builders can let us enforce more complex constraints, like our pipeline&#39;s output-equals-input constraint.
  </p>

  <p>We can achieve that by using a technique that I&#39;m calling <em>Mutable Generic State</em>.
  </p>

  <p><em>If it already has a name, please <a href="https://twitter.com/stewaterman">let me know</a>. I spent a long time looking.</em></p>

  <h2>Mutable Generic State</h2>

  <p>Mutable Generic State is a technique which uses immutable classes to give the impression of a class with mutable generic types.
  </p>

  <p>Let&#39;s imagine a simple string wrapper class.
    It stores a string which can be accessed with <code>.get()</code> and updated with <code>.set()</code>.
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Mutable Generics 1</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-attr">a</span>: <span class="hljs-title class_">StringWrapper</span> = <span class="hljs-title function_">wrap</span>(<span class="hljs-string">&quot;hello&quot;</span>);</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">a.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;friends!&quot;</span>);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> <span class="hljs-attr">a</span>: <span class="hljs-title class_">StringWrapper</span> = <span class="hljs-title function_">wrap</span>(<span class="hljs-string">&quot;hello&quot;</span>);
a.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;friends!&quot;</span>);</code>
</figure>

  <p>Here, the return type of <code>a.get()</code> is <code>string</code>.
    We can make <code>a.get()</code> return <code>&quot;hello&quot;</code>, by using type literals in a generic type:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Mutable Generics 2</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-attr">a</span>: <span class="hljs-title class_">StringWrapper</span>&lt;<span class="hljs-string">&quot;hello&quot;</span>&gt; = <span class="hljs-title function_">wrap</span>(<span class="hljs-string">&quot;hello&quot;</span>);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> <span class="hljs-attr">a</span>: <span class="hljs-title class_">StringWrapper</span>&lt;<span class="hljs-string">&quot;hello&quot;</span>&gt; = <span class="hljs-title function_">wrap</span>(<span class="hljs-string">&quot;hello&quot;</span>);</code>
</figure>

  <p>However, now we can&#39;t call <code>a.set()</code> unless the new value is also <code>&quot;hello&quot;</code>.
    With Mutable Generic State, it all works as expected:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Mutable Generics 3</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-attr">a</span>: <span class="hljs-title class_">StringWrapper</span>&lt;<span class="hljs-string">&quot;hello&quot;</span>&gt; = <span class="hljs-title function_">wrap</span>(<span class="hljs-string">&quot;hello&quot;</span>);</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-attr">b</span>: <span class="hljs-title class_">StringWrapper</span>&lt;<span class="hljs-string">&quot;friends&quot;</span>&gt; = a.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;friends!&quot;</span>);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> <span class="hljs-attr">a</span>: <span class="hljs-title class_">StringWrapper</span>&lt;<span class="hljs-string">&quot;hello&quot;</span>&gt; = <span class="hljs-title function_">wrap</span>(<span class="hljs-string">&quot;hello&quot;</span>);
<span class="hljs-keyword">const</span> <span class="hljs-attr">b</span>: <span class="hljs-title class_">StringWrapper</span>&lt;<span class="hljs-string">&quot;friends&quot;</span>&gt; = a.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;friends!&quot;</span>);</code>
</figure>

  <p>The trick here is that we&#39;ve made <code>StringWrapper</code> immutable.
    When we call <code>.set()</code>, we are actually creating a new instance of StringWrapper with a different generic parameter.
    Once those calls are inlined, there&#39;s no way to tell that each <code>.set()</code> call produces a new wrapper:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Mutable Generics 4</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> a = <span class="hljs-title function_">wrap</span>(<span class="hljs-string">&quot;hello&quot;</span>).<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;there&quot;</span>).<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;friends!&quot;</span>);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> a = <span class="hljs-title function_">wrap</span>(<span class="hljs-string">&quot;hello&quot;</span>).<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;there&quot;</span>).<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;friends!&quot;</span>);</code>
</figure>

  <figure><img src="/assets/blog/typescript-builders/Builders-MGS.svg" title="Sadly, one thing builders can't solve is YOU BEING AN IDIOT THAT FORGETS THE SPACES" alt="Achieves the same thing but using repeated append calls on a builder" class="svelte-1wsp3u5"></figure>

  <p>From the user&#39;s perspective, it&#39;s like we&#39;ve <em>mutated</em> the generic type from <code>&quot;hello&quot;</code> to <code>&quot;there&quot;</code> to <code>&quot;friends!&quot;</code>.
    The generic type tells us something about the current state of the builder, and it mutates when the builder does.
    That&#39;s where the name comes from - it&#39;s <em>state</em>, stored in the <em>generic</em> types, which is <em>mutable</em>.
  </p>

  <h2>Types of Constraints</h2>

  <p>When thinking about types, we think of it in terms of <em>constraining</em> the set of possible data types.
    Some of those constraints are <em>simple</em>:
  </p>

  <blockquote>String wrappers should contain a string
  </blockquote>

  <p>Some constraints are <em>complex</em>:
  </p>

  <blockquote>Calling <code>.get()</code> on a string wrapper should return the type of the argument passed in the last call to <code>.set()</code></blockquote>

  <p>Complex constraints are <em>relative</em>.
    They change based on previous method calls, or previous elements in an array.
    In the case of <code>StringWrapper</code>, the arguments passed to <code>.set()</code> are conditionally valid based on previous <code>.set()</code> calls.
  </p>

  <p>That&#39;s not the only requirement though.
    A constraint can only be complex if it is potentially infinite.
    Otherwise, we could just list all valid type combinations.
    Our string wrapper has an infinite number of strings it could hold, and no limit on the number of calls to <code>.set()</code>.
  </p>

  <h2>When to use builders</h2>

  <p>Builders are clunky, hard to write, and hard to use.
    If you can do it without a builder, that&#39;s probably best.
    They should be a last resort.
  </p>

  <p>It&#39;s not always possible to use a builder.
    For example, builders can&#39;t help when writing type definitions for a pre-existing JavaScript library, as they exist in the compiled JavaScript code.
    You can still use builders in a wrapper around the library though!
  </p>

  <p>Sometimes, a builder is more readable and simpler than the alternative.
    If it&#39;s <em>technically possible</em> to achieve without a builder, but you don&#39;t know how, a builder is still a valid choice.
    In fact, as of TypeScript 4, you <em>technically</em> never need a builder.
    I&#39;ll come back to this right at the end, so keep an eye out.
    In practice though, a builder is usually a better option.
  </p>

  <p>If it wasn&#39;t already obvious, our pipeline example is a good candidate for a builder!
  </p>

  <h2>Builder building 1: Identifying the Generics</h2>

  <p>Now we&#39;re set on solving the problem with a builder, where do we start?
    The first step is to identify the generic types it needs.
    Some of those types will change as we call methods on the builder - the mutable generic state.
    Others are just normal generic types.
  </p>

  <p>There are two places we need to look:
  </p>

  <ol><li>The builder&#39;s output</li>
    <li>The complex constraints</li></ol>

  <p>The builder&#39;s output is dependent on what we passed in our method calls.
    In order to correctly type it, we need to add some generic state to the builder.
    In our case, the output is a function which performs some kind of data transformation on an input, producing an output, based on config.
    All three of those should be generic types.
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Output-Generics.svg" title="They were right there all along!" alt="The generic types needed for the built pipeline are the input, output, and config" class="svelte-1wsp3u5"></figure>

  <p>Next, we need to think about the constraints on our builder and how they map to Mutable Generic State.
  </p>

  <p>To create our pipeline, we need a sequence of stages where:
  </p>

  <ul><li>There is a defined order</li>
    <li>Each one has two arguments - input and config</li>
    <li>The output of one stage is the first argument to the next stage</li></ul>

  <figure><img src="/assets/blog/typescript-builders/Builders-Mutation-Constraint.svg" title="Make them all fit together" alt="Visual representation of those bullet points using the jigsaw-like style" class="svelte-1wsp3u5"></figure>

  <p>The first constraint is achieved by simply storing the stages in a list in the order they were added to the builder.
    The second constraint is a simple type definition: <code>(input: any, config: any) =&gt; any</code>.
    The final constraint is complex, and must be enforced using Mutable Generic State.
  </p>

  <h3>Enforcing Stage Consistency</h3>

  <p>Consider the builder in an intermediate state.
    We have a few stages already added, and assume that everything is correct until now.
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Intermediate-Builder.svg" title="A happy little community of stages!" alt="The builder has 3 stages added" class="svelte-1wsp3u5"></figure>

  <p>What information do we need about the previous calls to add a new stage to our pipeline?
    Well, that depends on how we add the new stage.
    I can see a few options:
  </p>

  <ol><li>Only add stages to the start of the pipeline</li>
    <li>Only add stages to the end of the pipeline</li>
    <li>Add stages anywhere valid in the pipeline assuming it doesn&#39;t make the pipeline invalid</li>
    <li>Add stages anywhere in the pipeline, even if it becomes invalid, and only allow building the pipeline when it&#39;s valid</li></ol>

  <p>All four options are <em>possible</em> using builders and Mutable Generic State, but some are easier than others.
  </p>

  <p>Options 1 and 2 are both pretty simple. 
    In option 1, we need to know the current pipeline input and the new stage&#39;s output.
    In option 2, we need the pipeline&#39;s output and the new stage&#39;s input.
  </p>

  <p>Option 3 is quite hard.
    We need to know the state before and after each stage of the pipeline:
  </p>

  <ul><li>If we insert at the start, we restrict the output of the new stage.</li>
    <li>If we insert at the end, we restrict the input of the new stage.</li>
    <li>If we insert in the middle, we restrict both the input and output. Both must be the same as the state at the insertion point.</li></ul>

  <p>Option 4 is nightmarish.
    I&#39;m not going to go into detail, because this is already an absurdly long post.
    Feel free to try, and let me know if you get it to work!
  </p>

  <p>We need to weigh up user-friendliness vs simplicity of writing the builder.
    To me, options 3 and 4 are too complex and don&#39;t make the final builder <em>that much</em> easier to use.
    Between options 1 and 2, there&#39;s no difference in complexity but adding to the end of the pipeline is more natural.
  </p>

  <p>Therefore, I&#39;m going with option 2.
    <strong>When adding a stage, we need to know its input and the current pipeline&#39;s output.</strong></p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Stage-Consistency-Check.svg" title="An outsider - but they mesh well!" alt="We add a fourth stage, and it is valid because it fits against the current output" class="svelte-1wsp3u5"></figure>

  <p>Getting the input of the new stage is simple with a generic type on the builder&#39;s <code>append</code> method.
  </p>

  <p>We already have an <code>Output</code> generic type on the builder, but we&#39;ll need to update it over time.
    Whenever we add a new stage to the pipeline, we update <code>Output</code> to be the output of the new stage.
  </p>

  <h3>Tracking the Config</h3>

  <p>There&#39;s one other constraint on our builder.
    The config in the resulting pipeline needs to provide the information to each stage.
    I&#39;m going to skip the in-depth discussion of how we could achieve that and tell you the solution.
    When talking about function parameters, it&#39;s simplest to just use a single config object.
  </p>

  <p>In other words, rather than our stages looking like this:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Pre Config</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true"><details class="svelte-19djgjm"><summary class="svelte-19djgjm">&lt;Show 7 identical lines&gt;</summary>
    <div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, multiplicand: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-comment">/*...*/</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pipeline</span> = <span class="hljs-function">(<span class="hljs-params"></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="code hidden svelte-19djgjm">  input: <span class="hljs-built_in">number</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="code hidden svelte-19djgjm">  multiplicand: <span class="hljs-built_in">number</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="code hidden svelte-19djgjm">  radix: <span class="hljs-built_in">number</span> <span class="hljs-comment">/*...*/</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="code hidden svelte-19djgjm"></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</div></details>

<div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, multiplicand: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-comment">/*...*/</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pipeline</span> = <span class="hljs-function">(<span class="hljs-params"></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code hidden svelte-19djgjm">  input: <span class="hljs-built_in">number</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code hidden svelte-19djgjm">  multiplicand: <span class="hljs-built_in">number</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="code hidden svelte-19djgjm">  radix: <span class="hljs-built_in">number</span> <span class="hljs-comment">/*...*/</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="code hidden svelte-19djgjm"></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, multiplicand: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {}
<span class="hljs-comment">/*...*/</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Pipeline</span> = <span class="hljs-function">(<span class="hljs-params">
  input: <span class="hljs-built_in">number</span>,
  multiplicand: <span class="hljs-built_in">number</span>,
  radix: <span class="hljs-built_in">number</span> <span class="hljs-comment">/*...*/</span>
</span>) =&gt;</span> <span class="hljs-built_in">number</span>;</code>
</figure>

  <p>We should just require them to look like this:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Post Config</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true"><details class="svelte-19djgjm"><summary class="svelte-19djgjm">&lt;Show 10 identical lines&gt;</summary>
    <div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, config: { multiplicand: <span class="hljs-built_in">number</span> }</span>): <span class="hljs-built_in">number</span> {}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-comment">/*...*/</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pipeline</span> = <span class="hljs-function">(<span class="hljs-params"></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="code hidden svelte-19djgjm">  input: <span class="hljs-built_in">number</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="code hidden svelte-19djgjm">  config: {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="code hidden svelte-19djgjm">    multiplicand: <span class="hljs-built_in">number</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="code hidden svelte-19djgjm">    radix: <span class="hljs-built_in">number</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="code hidden svelte-19djgjm">    /*...*/</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="code hidden svelte-19djgjm"></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</div></details>

<div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, config: { multiplicand: <span class="hljs-built_in">number</span> }</span>): <span class="hljs-built_in">number</span> {}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-comment">/*...*/</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pipeline</span> = <span class="hljs-function">(<span class="hljs-params"></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code hidden svelte-19djgjm">  input: <span class="hljs-built_in">number</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code hidden svelte-19djgjm">  config: {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="code hidden svelte-19djgjm">    multiplicand: <span class="hljs-built_in">number</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="code hidden svelte-19djgjm">    radix: <span class="hljs-built_in">number</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="code hidden svelte-19djgjm">    /*...*/</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="code hidden svelte-19djgjm"></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, config: { multiplicand: <span class="hljs-built_in">number</span> }</span>): <span class="hljs-built_in">number</span> {}
<span class="hljs-comment">/*...*/</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Pipeline</span> = <span class="hljs-function">(<span class="hljs-params">
  input: <span class="hljs-built_in">number</span>,
  config: {
    multiplicand: <span class="hljs-built_in">number</span>;
    radix: <span class="hljs-built_in">number</span>;
    /*...*/
  }
</span>) =&gt;</span> <span class="hljs-built_in">number</span>;</code>
</figure>

  <p>The first example can work, but it&#39;s usually not worth the extra effort.
  </p>

  <p>We already had the <code>Config</code> generic type, but now we know it needs to be mutable.
    Whenever we append a stage, its config parameters should be added to the <code>Config</code> generic type.
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Config-Consistency.svg" title="Grow! GROW!!!" alt="When we add a fourth stage, the config is also updated" class="svelte-1wsp3u5"></figure>

  <h2>Builder building 2: Structuring the Builder</h2>

  <p>Now we know what our generic types are and how they update, we can start writing our builder.
    Just focus on the types for now, since that&#39;s the hard bit.
    We can fill in the method stubs later.
  </p>

  <h3>Class Definition</h3>

  <p>Create a new class for our builder, with the generics we figured out previously.
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Builder Class</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {}</code>
</figure>

  <p>If you haven&#39;t seen the <a href="https://www.typescriptlang.org/docs/handbook/utility-types.html#recordkeystype">Record type</a> before, just know that we&#39;re saying that <code>Config</code> must be an object with strings for its keys.
  </p>

  <h3>Build definition</h3>

  <p>The build method creates the output of the pipeline.
    It&#39;s really nothing special.
    We declare a method which outputs a pipeline function based on the generic types:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Build Definition</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>): <span class="hljs-function">(<span class="hljs-params">input: Input, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Output</span> {}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>): <span class="hljs-function">(<span class="hljs-params">input: Input, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Output</span> {}</code>
</figure>

  <h3>Mutator Definition</h3>

  <p>The mutator method is the one that changes something about the object, in our case <code>append</code>.
    It&#39;s not an entirely accurate name, since our builders are immutable, but it makes sense when we&#39;re conceptualising them as mutable objects.
  </p>

  <p>Thinking back to our discussion about how to enforce the constraints with Mutable Generic State, how should each of the three type parameters change after a call to append?
    Firstly, <code>Input</code> should not change. Stages are added to the end of the pipeline and don&#39;t affect the start.
  </p>

  <p>Regarding <code>Output</code>, we said:
  </p>

  <blockquote>Whenever we add a new stage to the pipeline, we update the type to be the output of the new stage.
  </blockquote>

  <p>Regarding <code>Config</code>, we said:
  </p>

  <blockquote>Whenever we append a new stage, any new parameters in that stage should be added to the <code>Config</code> generic type.
  </blockquote>

  <p>In terms of a type definition, that looks like this:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Append Definition</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">function</span> append&lt;<span class="hljs-title class_">NewConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">NewOutput</span>&gt;(</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-attr">func</span>: <span class="hljs-function">(<span class="hljs-params">state: Output, config: NewConfig</span>) =&gt;</span> <span class="hljs-title class_">NewOutput</span></div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> &amp; <span class="hljs-title class_">NewConfig</span>, <span class="hljs-title class_">NewOutput</span>&gt; {}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> append&lt;<span class="hljs-title class_">NewConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">NewOutput</span>&gt;(
  <span class="hljs-attr">func</span>: <span class="hljs-function">(<span class="hljs-params">state: Output, config: NewConfig</span>) =&gt;</span> <span class="hljs-title class_">NewOutput</span>
): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> &amp; <span class="hljs-title class_">NewConfig</span>, <span class="hljs-title class_">NewOutput</span>&gt; {}</code>
</figure>

  <p><code>Output</code> becomes <code>NewOutput</code> and <code>Config</code> becomes <code>Config &amp; NewConfig</code>, an <a href="https://www.typescriptlang.org/docs/handbook/unions-and-intersections.html#intersection-types">intersection type</a>.
  </p>

  <p>Notice that after a few calls to <code>append</code>, the <code>Config</code> type will be something like <code>Config &amp; NewConfig1 &amp; NewConfig2 &amp; NewConfig3 &amp; NewConfig4</code></p>

  <p>That is harmless, and just a quirk of the Mutable Generic State, so don&#39;t be alarmed if you see a huge type when you weren&#39;t expecting one.
  The autocomplete will get better once the builder is done and in use.
  </p>

  <h3>Internal State</h3>

  <p>The internal state should just be whatever the <code>build</code> method needs for its implementation.
  In our case, we only need the list of stages.
  We add that as a private readonly property, and give it the narrowest type we can:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Stage</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">stages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">state: <span class="hljs-built_in">any</span>, config: Config</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;;</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">stages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">state: <span class="hljs-built_in">any</span>, config: Config</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;;
}</code>
</figure>

  <h3>Instantiation</h3>

  <p>Up until this point, we have ignored how to instantiate a new pipeline builder, just assuming that we had one ready-made.
    Unsurprisingly, it&#39;s more complex than just adding a constructor.
    In fact, we need two different ways of creating a builder.
  </p>

  <p>First, we need a private constructor to use internally.
    It allows &#39;mutation&#39; of the builder, setting <code>stages</code> to any value, even if that would break the resulting pipeline.
    That&#39;s why it must be private.
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Constructor</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">stages: <span class="hljs-built_in">Array</span>&lt;(state: <span class="hljs-built_in">any</span>, config: Config) =&gt; <span class="hljs-built_in">any</span>&gt;</span>) {}</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">stages: <span class="hljs-built_in">Array</span>&lt;(state: <span class="hljs-built_in">any</span>, config: Config) =&gt; <span class="hljs-built_in">any</span>&gt;</span>) {}
}</code>
</figure>

  <p>Secondly, we need a public creation method.
    It should set reasonable defaults for the type parameters where possible, in line with what you&#39;d expect from an &#39;empty&#39; builder.
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Static Instantiator</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-keyword">static</span> <span class="hljs-keyword">new</span>&lt;<span class="hljs-title class_">Input</span>&gt;(): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, {}, <span class="hljs-title class_">Input</span>&gt; {}</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">new</span>&lt;<span class="hljs-title class_">Input</span>&gt;(): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, {}, <span class="hljs-title class_">Input</span>&gt; {}
}</code>
</figure>

  <p>Here, the <code>Config</code> parameter was set to a reasonable default of <code>{}</code>, since a pipeline with no stages doesn&#39;t need config.
    Other type parameters may have to be manually specified by the user, like the <code>Input</code> type.
    The <code>Output</code> type is the same as <code>Input</code> since a pipeline with no stages just outputs the input.
  </p>

  <p>Alternatively, by requiring at least one stage in each pipeline, there&#39;s no need to manually specify any generic types:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Inferred Generics</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-keyword">static</span> <span class="hljs-keyword">new</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt;(</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">    <span class="hljs-attr">stage</span>: <span class="hljs-function">(<span class="hljs-params">state: Input, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Output</span></div><div class="fromLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code same svelte-19djgjm">  ): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span>, <span class="hljs-title class_">Output</span>&gt; {}</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code same svelte-19djgjm">}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">new</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt;(
    <span class="hljs-attr">stage</span>: <span class="hljs-function">(<span class="hljs-params">state: Input, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Output</span>
  ): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span>, <span class="hljs-title class_">Output</span>&gt; {}
}</code>
</figure>

  <p>I&#39;m going with the first option, but it&#39;s a matter of preference.
  </p>

  <h2>Builder building 3: Implementation</h2>

  <p>Finally, the method stubs need implementing.
    The implementation is standard TypeScript, without having to worry about the complex constraints.
    Those are handled by the method signatures.
  </p>

  <p>However, be aware that the builder <strong>isn&#39;t really type-safe</strong>, at least internally.
    A few casts are needed to get the types to work, which means simple mistakes like adding a stage in the wrong location won&#39;t cause type errors.
    Double-checking that everything lines up is imperative.
  </p>

  <p>Implementing those methods is the last step, meaning the builder is now done!
    Here&#39;s one I made earlier:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Implementation</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true"><details class="svelte-19djgjm"><summary class="svelte-19djgjm">&lt;Show 25 identical lines&gt;</summary>
    <div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">stages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">state: <span class="hljs-built_in">any</span>, config: Config</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">stages: <span class="hljs-built_in">Array</span>&lt;(state: <span class="hljs-built_in">any</span>, config: Config) =&gt; <span class="hljs-built_in">any</span>&gt;</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stages</span> = stages;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">static</span> <span class="hljs-keyword">new</span>&lt;<span class="hljs-title class_">Input</span>&gt;(): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, {}, <span class="hljs-title class_">Input</span>&gt; {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineBuilder</span>([]);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">11</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">11</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">12</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">12</div>
        <div class="code hidden svelte-19djgjm">  append&lt;<span class="hljs-title class_">NewConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">NewOutput</span>&gt;(</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">13</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">13</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-attr">newStage</span>: <span class="hljs-function">(<span class="hljs-params">state: Output, config: NewConfig</span>) =&gt;</span> <span class="hljs-title class_">NewOutput</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">14</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">14</div>
        <div class="code hidden svelte-19djgjm">  ): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> &amp; <span class="hljs-title class_">NewConfig</span>, <span class="hljs-title class_">NewOutput</span>&gt; {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">15</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">15</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">const</span> <span class="hljs-attr">newStages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">state: <span class="hljs-built_in">any</span>, config: Config &amp; NewConfig</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">16</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">16</div>
        <div class="code hidden svelte-19djgjm">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stages</span>.<span class="hljs-title function_">slice</span>();</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">17</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">17</div>
        <div class="code hidden svelte-19djgjm">    newStages.<span class="hljs-title function_">push</span>(newStage);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">18</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">18</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> &amp; <span class="hljs-title class_">NewConfig</span>, <span class="hljs-title class_">NewOutput</span>&gt;(newStages);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">19</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">19</div>
        <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">20</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">20</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">21</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">21</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-title function_">build</span>(): <span class="hljs-function">(<span class="hljs-params">input: Input, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Output</span> {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">22</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">22</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">input: Input, config: Config</span>) =&gt;</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">23</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">23</div>
        <div class="code hidden svelte-19djgjm">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stages</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">state, stage</span>) =&gt;</span> <span class="hljs-title function_">stage</span>(state, config), input);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">24</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">24</div>
        <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">25</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">25</div>
        <div class="code hidden svelte-19djgjm">}</div></details>

<div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">stages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">state: <span class="hljs-built_in">any</span>, config: Config</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">stages: <span class="hljs-built_in">Array</span>&lt;(state: <span class="hljs-built_in">any</span>, config: Config) =&gt; <span class="hljs-built_in">any</span>&gt;</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stages</span> = stages;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">static</span> <span class="hljs-keyword">new</span>&lt;<span class="hljs-title class_">Input</span>&gt;(): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, {}, <span class="hljs-title class_">Input</span>&gt; {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineBuilder</span>([]);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">11</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">11</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">12</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">12</div>
  <div class="code hidden svelte-19djgjm">  append&lt;<span class="hljs-title class_">NewConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">NewOutput</span>&gt;(</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">13</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">13</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-attr">newStage</span>: <span class="hljs-function">(<span class="hljs-params">state: Output, config: NewConfig</span>) =&gt;</span> <span class="hljs-title class_">NewOutput</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">14</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">14</div>
  <div class="code hidden svelte-19djgjm">  ): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> &amp; <span class="hljs-title class_">NewConfig</span>, <span class="hljs-title class_">NewOutput</span>&gt; {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">15</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">15</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">const</span> <span class="hljs-attr">newStages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">state: <span class="hljs-built_in">any</span>, config: Config &amp; NewConfig</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">16</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">16</div>
  <div class="code hidden svelte-19djgjm">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stages</span>.<span class="hljs-title function_">slice</span>();</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">17</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">17</div>
  <div class="code hidden svelte-19djgjm">    newStages.<span class="hljs-title function_">push</span>(newStage);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">18</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">18</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> &amp; <span class="hljs-title class_">NewConfig</span>, <span class="hljs-title class_">NewOutput</span>&gt;(newStages);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">19</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">19</div>
  <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">20</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">20</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">21</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">21</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-title function_">build</span>(): <span class="hljs-function">(<span class="hljs-params">input: Input, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Output</span> {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">22</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">22</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">input: Input, config: Config</span>) =&gt;</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">23</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">23</div>
  <div class="code hidden svelte-19djgjm">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stages</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">state, stage</span>) =&gt;</span> <span class="hljs-title function_">stage</span>(state, config), input);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">24</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">24</div>
  <div class="code hidden svelte-19djgjm">  }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">25</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">25</div>
  <div class="code hidden svelte-19djgjm">}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">Output</span>&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">stages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">state: <span class="hljs-built_in">any</span>, config: Config</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;;

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">stages: <span class="hljs-built_in">Array</span>&lt;(state: <span class="hljs-built_in">any</span>, config: Config) =&gt; <span class="hljs-built_in">any</span>&gt;</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stages</span> = stages;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">new</span>&lt;<span class="hljs-title class_">Input</span>&gt;(): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, {}, <span class="hljs-title class_">Input</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineBuilder</span>([]);
  }

  append&lt;<span class="hljs-title class_">NewConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;, <span class="hljs-title class_">NewOutput</span>&gt;(
    <span class="hljs-attr">newStage</span>: <span class="hljs-function">(<span class="hljs-params">state: Output, config: NewConfig</span>) =&gt;</span> <span class="hljs-title class_">NewOutput</span>
  ): <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> &amp; <span class="hljs-title class_">NewConfig</span>, <span class="hljs-title class_">NewOutput</span>&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">newStages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">state: <span class="hljs-built_in">any</span>, config: Config &amp; NewConfig</span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt; =
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stages</span>.<span class="hljs-title function_">slice</span>();
    newStages.<span class="hljs-title function_">push</span>(newStage);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineBuilder</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> &amp; <span class="hljs-title class_">NewConfig</span>, <span class="hljs-title class_">NewOutput</span>&gt;(newStages);
  }

  <span class="hljs-title function_">build</span>(): <span class="hljs-function">(<span class="hljs-params">input: Input, config: Config</span>) =&gt;</span> <span class="hljs-title class_">Output</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">input: Input, config: Config</span>) =&gt;</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stages</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">state, stage</span>) =&gt;</span> <span class="hljs-title function_">stage</span>(state, config), input);
  }
}</code>
</figure>

  <p>In a whistle-stop tour of the implementation, we see that:
  </p>

  <ul><li>The constructor sets the <code>stages</code> property</li>
    <li><code>new</code> creates an empty builder - one with no stages</li>
    <li><code>append</code> creates a new list of stages, adds the new stage, and returns a new builder based on that</li>
    <li><code>build</code> returns a function which takes an input and some config, then sequentially applies the stages</li></ul>

  <h3>Usage</h3>

  <p>Let&#39;s see the builder in action:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Usage</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true"><details class="svelte-19djgjm"><summary class="svelte-19djgjm">&lt;Show 22 identical lines&gt;</summary>
    <div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span></span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">toInt</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: { radix: <span class="hljs-built_in">number</span> }</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(input, config.<span class="hljs-property">radix</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, config: { multiplicand: <span class="hljs-built_in">number</span> }</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> input * config.<span class="hljs-property">multiplicand</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">11</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">11</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">12</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">12</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">13</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">13</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;()</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">14</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">14</div>
        <div class="code hidden svelte-19djgjm">  .<span class="hljs-title function_">append</span>(reverse)</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">15</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">15</div>
        <div class="code hidden svelte-19djgjm">  .<span class="hljs-title function_">append</span>(toInt)</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">16</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">16</div>
        <div class="code hidden svelte-19djgjm">  .<span class="hljs-title function_">append</span>(multiply)</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">17</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">17</div>
        <div class="code hidden svelte-19djgjm">  .<span class="hljs-title function_">build</span>();</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">18</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">18</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">19</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">19</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;532&quot;</span>, {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">20</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">20</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-attr">radix</span>: <span class="hljs-number">10</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">21</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">21</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">22</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">22</div>
        <div class="code hidden svelte-19djgjm">});</div></details>

<div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span></span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">toInt</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: { radix: <span class="hljs-built_in">number</span> }</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(input, config.<span class="hljs-property">radix</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, config: { multiplicand: <span class="hljs-built_in">number</span> }</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> input * config.<span class="hljs-property">multiplicand</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">11</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">11</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">12</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">12</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">13</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">13</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;()</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">14</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">14</div>
  <div class="code hidden svelte-19djgjm">  .<span class="hljs-title function_">append</span>(reverse)</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">15</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">15</div>
  <div class="code hidden svelte-19djgjm">  .<span class="hljs-title function_">append</span>(toInt)</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">16</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">16</div>
  <div class="code hidden svelte-19djgjm">  .<span class="hljs-title function_">append</span>(multiply)</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">17</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">17</div>
  <div class="code hidden svelte-19djgjm">  .<span class="hljs-title function_">build</span>();</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">18</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">18</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">19</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">19</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;532&quot;</span>, {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">20</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">20</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-attr">radix</span>: <span class="hljs-number">10</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">21</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">21</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span>,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">22</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">22</div>
  <div class="code hidden svelte-19djgjm">});</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">return</span> input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">toInt</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: { radix: <span class="hljs-built_in">number</span> }</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(input, config.<span class="hljs-property">radix</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, config: { multiplicand: <span class="hljs-built_in">number</span> }</span>) {
  <span class="hljs-keyword">return</span> input * config.<span class="hljs-property">multiplicand</span>;
}

<span class="hljs-keyword">const</span> pipeline = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;()
  .<span class="hljs-title function_">append</span>(reverse)
  .<span class="hljs-title function_">append</span>(toInt)
  .<span class="hljs-title function_">append</span>(multiply)
  .<span class="hljs-title function_">build</span>();

<span class="hljs-keyword">const</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;532&quot;</span>, {
  <span class="hljs-attr">radix</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span>,
});</code>
</figure>

  <p>I defined the stages above, but they could&#39;ve been inlined as arrow functions.
  </p>

  <p>We call <code>PipelineBuilder.new&lt;string&gt;()</code> to create a new builder that takes a string as input.
    Then we append our three functions in the correct order.
    Finally, we call <code>.build()</code> to get a pipeline that we can call, and then we try it out.
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Usage.svg" title="The code may be simple, but the complexity of this diagram makes me feel a bit better about how long the post is!" alt="Visual representation of the last paragraph's description" class="svelte-1wsp3u5"></figure>

  <p>It&#39;s hard to demonstrate the builder, because the most impressive bit is all the things you <em>can&#39;t do</em>.
    Here&#39;s a gallery of things that won&#39;t compile:
  </p>

  <hr>

  <p><strong>Invalid first pipeline stage, <code>multiply</code> takes a <code>number</code> but got a <code>string</code></strong>:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Invalid first pipeline stage</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;().<span class="hljs-title function_">append</span>(multiply);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;().<span class="hljs-title function_">append</span>(multiply);</code>
</figure>

  <hr>

  <p><strong>Invalid second pipeline stage, <code>toInt</code> outputs a number but inputs a string</strong>:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Invalid second pipeline stage</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;().<span class="hljs-title function_">append</span>(toInt).<span class="hljs-title function_">append</span>(toInt);</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;().<span class="hljs-title function_">append</span>(toInt).<span class="hljs-title function_">append</span>(toInt);</code>
</figure>

  <hr>

  <p><strong>Invalid type on <code>output</code>, pipeline returns <code>string</code></strong>:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Invalid type on output</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;().<span class="hljs-title function_">append</span>(reverse).<span class="hljs-title function_">build</span>();</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm"> </div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;532&quot;</span>, {});</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;().<span class="hljs-title function_">append</span>(reverse).<span class="hljs-title function_">build</span>();

<span class="hljs-keyword">const</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;532&quot;</span>, {});</code>
</figure>

  <hr>

  <p><strong>Invalid pipeline input, should be string</strong>:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Invalid pipeline input</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">pipeline</span>(<span class="hljs-number">532</span>, {</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-attr">radix</span>: <span class="hljs-number">10</span>,</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span>,</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code same svelte-19djgjm">});</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">pipeline</span>(<span class="hljs-number">532</span>, {
  <span class="hljs-attr">radix</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span>,
});</code>
</figure>

  <hr>

  <p><strong>Invalid config, missing radix</strong>:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Invalid config</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;532&quot;</span>, {</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span>,</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">});</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;532&quot;</span>, {
  <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span>,
});</code>
</figure>

  <hr>

  <p><a href="https://en.wikipedia.org/wiki/Soundness">Sound.</a></p>

  <h2>Analysing the Builder</h2>

  <p>This is not a simple technique, and I&#39;ve really hyped it up.
    However, there are drawbacks, and things can easily go wrong.
    Let&#39;s discuss a couple of those rough edges.
  </p>

  <h3>Immutable internal state</h3>

  <p>Each call to the <code>.append()</code> method creates a new builder.
    That&#39;s a bit slow, but that&#39;s not the main issue.
    There&#39;s no guarantee that someone won&#39;t hold on to an old builder, like this:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Reusing Builders</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> a = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;();</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> b = a.<span class="hljs-title function_">append</span>(<span class="hljs-function">(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: {}</span>) =&gt;</span> <span class="hljs-built_in">parseInt</span>(input));</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">const</span> pipeline = a.<span class="hljs-title function_">build</span>();</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">const</span> a = <span class="hljs-title class_">PipelineBuilder</span>.<span class="hljs-property">new</span>&lt;<span class="hljs-built_in">string</span>&gt;();
<span class="hljs-keyword">const</span> b = a.<span class="hljs-title function_">append</span>(<span class="hljs-function">(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: {}</span>) =&gt;</span> <span class="hljs-built_in">parseInt</span>(input));
<span class="hljs-keyword">const</span> pipeline = a.<span class="hljs-title function_">build</span>();</code>
</figure>

  <p>If <code>stages</code> was mutable, and append looked like this:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Mutable Stages</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true">

<div class="fromLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code same svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">append</span>(<span class="hljs-params"><span class="hljs-comment">/*...*/</span></span>) {</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code same svelte-19djgjm">  stages.<span class="hljs-title function_">append</span>(func);</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code same svelte-19djgjm">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineBuilder</span>(stages);</div><div class="fromLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine same svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code same svelte-19djgjm">}</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">function</span> <span class="hljs-title function_">append</span>(<span class="hljs-params"><span class="hljs-comment">/*...*/</span></span>) {
  stages.<span class="hljs-title function_">append</span>(func);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineBuilder</span>(stages);
}</code>
</figure>

  <p>Then <code>a</code> and <code>b</code> both hold the same reference to <code>stages</code>, and now both contain one stage.
    However, the <code>Output</code> type parameter on <code>a</code> says it returns a string.
    In reality, a pipeline created from <code>a</code> would be identical to one created from <code>b</code>, and would return a number.
  </p>

  <p>The long and short of it is: <strong>the builder&#39;s variables must be immutable</strong>.
  </p>

  <h3>Unsafe types</h3>

  <p>The implementation has <code>any</code> littered throughout it.
    If you&#39;re anything like me then alarms are ringing.
    Isn&#39;t the whole point that we want to <em>increase</em> type safety?
  </p>

  <p>Yes, and that&#39;s the core issue.
    If we could write a correct type for <code>stages</code>, one which guarantees the input to a stage is the output of the previous one, we wouldn&#39;t need a builder.
    We can&#39;t do that directly*, so instead we guarantee that the type meets those requirements through the type signature of <code>.append()</code>.
  </p>

  <p>Essentially, we encapsulate all the type-unsafe code behind a type-safe interface.
    For that reason, adding to a builder like in <code>.append()</code> requires extreme care.
    That internal constructor <em>is not</em> type-safe, and would accept almost anything.
    If the list passed to the constructor breaks that <code>input to x == output of x-1</code> guarantee, then any pipelines built from it will break.
  </p>

  <h3>Another Way?</h3>

  <p>There was a suspicious asterisk in the previous section, and earlier I promised to tell you more about the wonders of TypeScript 4.
    Buckle up!
  </p>

  <p>For the entirety of this post, we&#39;ve just accepted the fact that you can only resolve complex constraints with builders.
    In fact, that&#39;s not true.
    I&#39;m not saying builders are useless, and in fact this section should come with a disclaimer:
  </p>

  <blockquote><strong>The stunts performed in this section were done with a complete disregard for best practice.</strong>
    <strong>Don&#39;t try this at work.</strong></blockquote>

  <hr>

  <p>Allow me to introduce <a href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-0/">TypeScript 4.0</a>, and more importantly, <a href="https://github.com/microsoft/TypeScript/pull/39094">Variadic Tuple Types</a>.
    Variadic tuple types <strong>massively</strong> increase the flexibility of TypeScript&#39;s tuples.
  </p>

  <p>With variadic tuples, we can actually implement anything we could use a builder for as a normal type constraint.
    It will be huge, unmaintainable, and really hard to write (this took me a day), but it&#39;s possible.
    Even better, these don&#39;t exist at runtime which means they work when writing type declarations for a 3rd-party library.
  </p>

  <p>Here&#39;s the pipeline without a builder:
  </p>

  <figure class="container wide snippet svelte-1omgi29"><h2 class="name svelte-1omgi29">Black Magic Code</h2>

	

	<code class="visualCode svelte-12l7s60" aria-hidden="true"><details class="svelte-19djgjm"><summary class="svelte-19djgjm">&lt;Show 79 identical lines&gt;</summary>
    <div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Tail</span>&lt;<span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt; = <span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">any</span>, ...infer T]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
        <div class="code hidden svelte-19djgjm">  ? T</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
        <div class="code hidden svelte-19djgjm">  : [];</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Last</span>&lt;<span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt; = <span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [...infer _, infer X]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
        <div class="code hidden svelte-19djgjm">  ? X</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
        <div class="code hidden svelte-19djgjm">  : <span class="hljs-built_in">never</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">UnionToIntersection</span>&lt;U&gt; = (U <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> ? <span class="hljs-function">(<span class="hljs-params">k: U</span>) =&gt;</span> <span class="hljs-built_in">void</span> : <span class="hljs-built_in">never</span>) <span class="hljs-keyword">extends</span> (</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-attr">k</span>: infer I</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
        <div class="code hidden svelte-19djgjm">) =&gt; <span class="hljs-built_in">void</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
        <div class="code hidden svelte-19djgjm">  ? I</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">11</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">11</div>
        <div class="code hidden svelte-19djgjm">  : <span class="hljs-built_in">never</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">12</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">12</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Equal</span>&lt;A, B&gt; = A <span class="hljs-keyword">extends</span> B ? (B <span class="hljs-keyword">extends</span> A ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>) : <span class="hljs-literal">false</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">13</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">13</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">14</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">14</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">any</span>, unknown&gt;, <span class="hljs-title class_">Output</span>&gt; = <span class="hljs-function">(<span class="hljs-params"></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">15</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">15</div>
        <div class="code hidden svelte-19djgjm">  input: Input,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">16</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">16</div>
        <div class="code hidden svelte-19djgjm">  config: Config</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">17</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">17</div>
        <div class="code hidden svelte-19djgjm"></span>) =&gt;</span> <span class="hljs-title class_">Output</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">18</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">18</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">19</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">19</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Input</span>&lt;<span class="hljs-title class_">Stage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt; = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">Stage</span>&gt;[<span class="hljs-number">0</span>];</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">20</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">20</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Config</span>&lt;<span class="hljs-title class_">Stage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt; = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">Stage</span>&gt;[<span class="hljs-number">1</span>];</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">21</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">21</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Output</span>&lt;<span class="hljs-title class_">Stage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt; = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-title class_">Stage</span>&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">22</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">22</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineInput</span>&lt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">23</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">23</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;, ...<span class="hljs-built_in">any</span>[]]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">24</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">24</div>
        <div class="code hidden svelte-19djgjm">&gt; = <span class="hljs-title class_">Input</span>&lt;<span class="hljs-title class_">Stages</span>[<span class="hljs-number">0</span>]&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">25</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">25</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineConfig</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">26</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">26</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">UnionToIntersection</span>&lt;<span class="hljs-title class_">Config</span>&lt;<span class="hljs-title class_">Stages</span>[<span class="hljs-built_in">number</span>]&gt;&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">27</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">27</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineOutput</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">28</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">28</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Output</span>&lt;<span class="hljs-title class_">Last</span>&lt;<span class="hljs-title class_">Stages</span>&gt;&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">29</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">29</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">30</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">30</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Match</span>&lt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">31</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">31</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">First</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">32</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">32</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Second</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">33</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">33</div>
        <div class="code hidden svelte-19djgjm">&gt; = <span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Output</span>&lt;<span class="hljs-title class_">First</span>&gt;, <span class="hljs-title class_">Input</span>&lt;<span class="hljs-title class_">Second</span>&gt;&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">34</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">34</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ValidPipeline</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">35</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">35</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">any</span>]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">36</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">36</div>
        <div class="code hidden svelte-19djgjm">    ? <span class="hljs-literal">true</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">37</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">37</div>
        <div class="code hidden svelte-19djgjm">    : <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, ...<span class="hljs-built_in">any</span>[]]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">38</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">38</div>
        <div class="code hidden svelte-19djgjm">    ? <span class="hljs-title class_">Match</span>&lt;<span class="hljs-title class_">Stages</span>[<span class="hljs-number">0</span>], <span class="hljs-title class_">Stages</span>[<span class="hljs-number">1</span>]&gt; <span class="hljs-keyword">extends</span> <span class="hljs-literal">true</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">39</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">39</div>
        <div class="code hidden svelte-19djgjm">      ? <span class="hljs-title class_">ValidPipeline</span>&lt;<span class="hljs-title class_">Tail</span>&lt;<span class="hljs-title class_">Stages</span>&gt;&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">40</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">40</div>
        <div class="code hidden svelte-19djgjm">      : <span class="hljs-literal">false</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">41</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">41</div>
        <div class="code hidden svelte-19djgjm">    : <span class="hljs-literal">false</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">42</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">42</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">43</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">43</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pipeline</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">44</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">44</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">ValidPipeline</span>&lt;<span class="hljs-title class_">Stages</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-literal">true</span> ? <span class="hljs-title class_">Stages</span> : <span class="hljs-built_in">never</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">45</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">45</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">46</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">46</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> createPipeline&lt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">47</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">47</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">48</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">48</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">49</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">49</div>
        <div class="code hidden svelte-19djgjm">    ...<span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">50</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">50</div>
        <div class="code hidden svelte-19djgjm">  ]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">51</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">51</div>
        <div class="code hidden svelte-19djgjm">&gt;(</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">52</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">52</div>
        <div class="code hidden svelte-19djgjm">  ...<span class="hljs-attr">pipeline</span>: <span class="hljs-title class_">Pipeline</span>&lt;<span class="hljs-title class_">Stages</span>&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">53</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">53</div>
        <div class="code hidden svelte-19djgjm">): <span class="hljs-function">(<span class="hljs-params"></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">54</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">54</div>
        <div class="code hidden svelte-19djgjm">  input: PipelineInput&lt;Stages&gt;,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">55</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">55</div>
        <div class="code hidden svelte-19djgjm">  config: PipelineConfig&lt;Stages&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">56</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">56</div>
        <div class="code hidden svelte-19djgjm"></span>) =&gt;</span> <span class="hljs-title class_">PipelineOutput</span>&lt;<span class="hljs-title class_">Stages</span>&gt; {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">57</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">57</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">input: PipelineInput&lt;Stages&gt;, config: PipelineConfig&lt;Stages&gt;</span>) =&gt;</span> {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">58</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">58</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">let</span> <span class="hljs-attr">state</span>: <span class="hljs-built_in">any</span> = input;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">59</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">59</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> stage <span class="hljs-keyword">of</span> pipeline) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">60</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">60</div>
        <div class="code hidden svelte-19djgjm">      state = <span class="hljs-title function_">stage</span>(state, config);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">61</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">61</div>
        <div class="code hidden svelte-19djgjm">    }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">62</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">62</div>
        <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> state;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">63</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">63</div>
        <div class="code hidden svelte-19djgjm">  };</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">64</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">64</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">65</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">65</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">66</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">66</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: {}</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">67</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">67</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">68</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">68</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">69</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">69</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">70</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">70</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">toInt</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: { radix: <span class="hljs-built_in">number</span> }</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">71</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">71</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(input, config.<span class="hljs-property">radix</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">72</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">72</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">73</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">73</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">74</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">74</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, config: { multiplicand: <span class="hljs-built_in">number</span> }</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">75</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">75</div>
        <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> input * config.<span class="hljs-property">multiplicand</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">76</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">76</div>
        <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">77</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">77</div>
        <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">78</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">78</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title function_">createPipeline</span>(reverse, toInt, multiply);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">79</div>
        <div class="toLine hidden svelte-19djgjm" aria-hidden="true">79</div>
        <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> output = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;524&quot;</span>, { <span class="hljs-attr">radix</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span> });</div></details>

<div class="fromLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">1</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Tail</span>&lt;<span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt; = <span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">any</span>, ...infer T]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">2</div>
  <div class="code hidden svelte-19djgjm">  ? T</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">3</div>
  <div class="code hidden svelte-19djgjm">  : [];</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">4</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Last</span>&lt;<span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt; = <span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [...infer _, infer X]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">5</div>
  <div class="code hidden svelte-19djgjm">  ? X</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">6</div>
  <div class="code hidden svelte-19djgjm">  : <span class="hljs-built_in">never</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">7</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">UnionToIntersection</span>&lt;U&gt; = (U <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> ? <span class="hljs-function">(<span class="hljs-params">k: U</span>) =&gt;</span> <span class="hljs-built_in">void</span> : <span class="hljs-built_in">never</span>) <span class="hljs-keyword">extends</span> (</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">8</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-attr">k</span>: infer I</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">9</div>
  <div class="code hidden svelte-19djgjm">) =&gt; <span class="hljs-built_in">void</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">10</div>
  <div class="code hidden svelte-19djgjm">  ? I</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">11</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">11</div>
  <div class="code hidden svelte-19djgjm">  : <span class="hljs-built_in">never</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">12</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">12</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Equal</span>&lt;A, B&gt; = A <span class="hljs-keyword">extends</span> B ? (B <span class="hljs-keyword">extends</span> A ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>) : <span class="hljs-literal">false</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">13</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">13</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">14</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">14</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">any</span>, unknown&gt;, <span class="hljs-title class_">Output</span>&gt; = <span class="hljs-function">(<span class="hljs-params"></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">15</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">15</div>
  <div class="code hidden svelte-19djgjm">  input: Input,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">16</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">16</div>
  <div class="code hidden svelte-19djgjm">  config: Config</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">17</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">17</div>
  <div class="code hidden svelte-19djgjm"></span>) =&gt;</span> <span class="hljs-title class_">Output</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">18</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">18</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">19</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">19</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Input</span>&lt;<span class="hljs-title class_">Stage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt; = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">Stage</span>&gt;[<span class="hljs-number">0</span>];</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">20</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">20</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Config</span>&lt;<span class="hljs-title class_">Stage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt; = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">Stage</span>&gt;[<span class="hljs-number">1</span>];</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">21</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">21</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Output</span>&lt;<span class="hljs-title class_">Stage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt; = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-title class_">Stage</span>&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">22</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">22</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineInput</span>&lt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">23</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">23</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;, ...<span class="hljs-built_in">any</span>[]]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">24</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">24</div>
  <div class="code hidden svelte-19djgjm">&gt; = <span class="hljs-title class_">Input</span>&lt;<span class="hljs-title class_">Stages</span>[<span class="hljs-number">0</span>]&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">25</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">25</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineConfig</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">26</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">26</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">UnionToIntersection</span>&lt;<span class="hljs-title class_">Config</span>&lt;<span class="hljs-title class_">Stages</span>[<span class="hljs-built_in">number</span>]&gt;&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">27</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">27</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineOutput</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">28</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">28</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Output</span>&lt;<span class="hljs-title class_">Last</span>&lt;<span class="hljs-title class_">Stages</span>&gt;&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">29</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">29</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">30</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">30</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Match</span>&lt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">31</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">31</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">First</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">32</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">32</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Second</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">33</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">33</div>
  <div class="code hidden svelte-19djgjm">&gt; = <span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Output</span>&lt;<span class="hljs-title class_">First</span>&gt;, <span class="hljs-title class_">Input</span>&lt;<span class="hljs-title class_">Second</span>&gt;&gt;;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">34</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">34</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ValidPipeline</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">35</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">35</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">any</span>]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">36</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">36</div>
  <div class="code hidden svelte-19djgjm">    ? <span class="hljs-literal">true</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">37</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">37</div>
  <div class="code hidden svelte-19djgjm">    : <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, ...<span class="hljs-built_in">any</span>[]]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">38</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">38</div>
  <div class="code hidden svelte-19djgjm">    ? <span class="hljs-title class_">Match</span>&lt;<span class="hljs-title class_">Stages</span>[<span class="hljs-number">0</span>], <span class="hljs-title class_">Stages</span>[<span class="hljs-number">1</span>]&gt; <span class="hljs-keyword">extends</span> <span class="hljs-literal">true</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">39</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">39</div>
  <div class="code hidden svelte-19djgjm">      ? <span class="hljs-title class_">ValidPipeline</span>&lt;<span class="hljs-title class_">Tail</span>&lt;<span class="hljs-title class_">Stages</span>&gt;&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">40</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">40</div>
  <div class="code hidden svelte-19djgjm">      : <span class="hljs-literal">false</span></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">41</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">41</div>
  <div class="code hidden svelte-19djgjm">    : <span class="hljs-literal">false</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">42</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">42</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">43</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">43</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pipeline</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">44</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">44</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">ValidPipeline</span>&lt;<span class="hljs-title class_">Stages</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-literal">true</span> ? <span class="hljs-title class_">Stages</span> : <span class="hljs-built_in">never</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">45</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">45</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">46</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">46</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> createPipeline&lt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">47</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">47</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">48</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">48</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">49</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">49</div>
  <div class="code hidden svelte-19djgjm">    ...<span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">50</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">50</div>
  <div class="code hidden svelte-19djgjm">  ]</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">51</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">51</div>
  <div class="code hidden svelte-19djgjm">&gt;(</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">52</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">52</div>
  <div class="code hidden svelte-19djgjm">  ...<span class="hljs-attr">pipeline</span>: <span class="hljs-title class_">Pipeline</span>&lt;<span class="hljs-title class_">Stages</span>&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">53</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">53</div>
  <div class="code hidden svelte-19djgjm">): <span class="hljs-function">(<span class="hljs-params"></div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">54</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">54</div>
  <div class="code hidden svelte-19djgjm">  input: PipelineInput&lt;Stages&gt;,</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">55</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">55</div>
  <div class="code hidden svelte-19djgjm">  config: PipelineConfig&lt;Stages&gt;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">56</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">56</div>
  <div class="code hidden svelte-19djgjm"></span>) =&gt;</span> <span class="hljs-title class_">PipelineOutput</span>&lt;<span class="hljs-title class_">Stages</span>&gt; {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">57</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">57</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">input: PipelineInput&lt;Stages&gt;, config: PipelineConfig&lt;Stages&gt;</span>) =&gt;</span> {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">58</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">58</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">let</span> <span class="hljs-attr">state</span>: <span class="hljs-built_in">any</span> = input;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">59</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">59</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> stage <span class="hljs-keyword">of</span> pipeline) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">60</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">60</div>
  <div class="code hidden svelte-19djgjm">      state = <span class="hljs-title function_">stage</span>(state, config);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">61</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">61</div>
  <div class="code hidden svelte-19djgjm">    }</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">62</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">62</div>
  <div class="code hidden svelte-19djgjm">    <span class="hljs-keyword">return</span> state;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">63</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">63</div>
  <div class="code hidden svelte-19djgjm">  };</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">64</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">64</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">65</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">65</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">66</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">66</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: {}</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">67</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">67</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">68</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">68</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">69</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">69</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">70</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">70</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">toInt</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: { radix: <span class="hljs-built_in">number</span> }</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">71</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">71</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(input, config.<span class="hljs-property">radix</span>);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">72</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">72</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">73</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">73</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">74</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">74</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, config: { multiplicand: <span class="hljs-built_in">number</span> }</span>) {</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">75</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">75</div>
  <div class="code hidden svelte-19djgjm">  <span class="hljs-keyword">return</span> input * config.<span class="hljs-property">multiplicand</span>;</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">76</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">76</div>
  <div class="code hidden svelte-19djgjm">}</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">77</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">77</div>
  <div class="code hidden svelte-19djgjm"> </div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">78</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">78</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> pipeline = <span class="hljs-title function_">createPipeline</span>(reverse, toInt, multiply);</div><div class="fromLine hidden svelte-19djgjm" aria-hidden="true">79</div>
  <div class="toLine hidden svelte-19djgjm" aria-hidden="true">79</div>
  <div class="code hidden svelte-19djgjm"><span class="hljs-keyword">const</span> output = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;524&quot;</span>, { <span class="hljs-attr">radix</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span> });</div></code>

<code class="sr-code svelte-12l7s60"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Tail</span>&lt;<span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt; = <span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">any</span>, ...infer T]
  ? T
  : [];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Last</span>&lt;<span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt; = <span class="hljs-variable constant_">XS</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [...infer _, infer X]
  ? X
  : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnionToIntersection</span>&lt;U&gt; = (U <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> ? <span class="hljs-function">(<span class="hljs-params">k: U</span>) =&gt;</span> <span class="hljs-built_in">void</span> : <span class="hljs-built_in">never</span>) <span class="hljs-keyword">extends</span> (
  <span class="hljs-attr">k</span>: infer I
) =&gt; <span class="hljs-built_in">void</span>
  ? I
  : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Equal</span>&lt;A, B&gt; = A <span class="hljs-keyword">extends</span> B ? (B <span class="hljs-keyword">extends</span> A ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>) : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">any</span>, unknown&gt;, <span class="hljs-title class_">Output</span>&gt; = <span class="hljs-function">(<span class="hljs-params">
  input: Input,
  config: Config
</span>) =&gt;</span> <span class="hljs-title class_">Output</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Input</span>&lt;<span class="hljs-title class_">Stage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt; = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">Stage</span>&gt;[<span class="hljs-number">0</span>];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Config</span>&lt;<span class="hljs-title class_">Stage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt; = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">Stage</span>&gt;[<span class="hljs-number">1</span>];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Output</span>&lt;<span class="hljs-title class_">Stage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt; = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-title class_">Stage</span>&gt;;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineInput</span>&lt;
  <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;, ...<span class="hljs-built_in">any</span>[]]
&gt; = <span class="hljs-title class_">Input</span>&lt;<span class="hljs-title class_">Stages</span>[<span class="hljs-number">0</span>]&gt;;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineConfig</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =
  <span class="hljs-title class_">UnionToIntersection</span>&lt;<span class="hljs-title class_">Config</span>&lt;<span class="hljs-title class_">Stages</span>[<span class="hljs-built_in">number</span>]&gt;&gt;;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PipelineOutput</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =
  <span class="hljs-title class_">Output</span>&lt;<span class="hljs-title class_">Last</span>&lt;<span class="hljs-title class_">Stages</span>&gt;&gt;;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Match</span>&lt;
  <span class="hljs-title class_">First</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;,
  <span class="hljs-title class_">Second</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;
&gt; = <span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Output</span>&lt;<span class="hljs-title class_">First</span>&gt;, <span class="hljs-title class_">Input</span>&lt;<span class="hljs-title class_">Second</span>&gt;&gt;;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ValidPipeline</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =
  <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">any</span>]
    ? <span class="hljs-literal">true</span>
    : <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, ...<span class="hljs-built_in">any</span>[]]
    ? <span class="hljs-title class_">Match</span>&lt;<span class="hljs-title class_">Stages</span>[<span class="hljs-number">0</span>], <span class="hljs-title class_">Stages</span>[<span class="hljs-number">1</span>]&gt; <span class="hljs-keyword">extends</span> <span class="hljs-literal">true</span>
      ? <span class="hljs-title class_">ValidPipeline</span>&lt;<span class="hljs-title class_">Tail</span>&lt;<span class="hljs-title class_">Stages</span>&gt;&gt;
      : <span class="hljs-literal">false</span>
    : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Pipeline</span>&lt;<span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]&gt; =
  <span class="hljs-title class_">ValidPipeline</span>&lt;<span class="hljs-title class_">Stages</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-literal">true</span> ? <span class="hljs-title class_">Stages</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">function</span> createPipeline&lt;
  <span class="hljs-title class_">Stages</span> <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> [
    <span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;,
    ...<span class="hljs-title class_">PipelineStage</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;[]
  ]
&gt;(
  ...<span class="hljs-attr">pipeline</span>: <span class="hljs-title class_">Pipeline</span>&lt;<span class="hljs-title class_">Stages</span>&gt;
): <span class="hljs-function">(<span class="hljs-params">
  input: PipelineInput&lt;Stages&gt;,
  config: PipelineConfig&lt;Stages&gt;
</span>) =&gt;</span> <span class="hljs-title class_">PipelineOutput</span>&lt;<span class="hljs-title class_">Stages</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">input: PipelineInput&lt;Stages&gt;, config: PipelineConfig&lt;Stages&gt;</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">state</span>: <span class="hljs-built_in">any</span> = input;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> stage <span class="hljs-keyword">of</span> pipeline) {
      state = <span class="hljs-title function_">stage</span>(state, config);
    }
    <span class="hljs-keyword">return</span> state;
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: {}</span>) {
  <span class="hljs-keyword">return</span> input.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">toInt</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span>, config: { radix: <span class="hljs-built_in">number</span> }</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(input, config.<span class="hljs-property">radix</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">input: <span class="hljs-built_in">number</span>, config: { multiplicand: <span class="hljs-built_in">number</span> }</span>) {
  <span class="hljs-keyword">return</span> input * config.<span class="hljs-property">multiplicand</span>;
}

<span class="hljs-keyword">const</span> pipeline = <span class="hljs-title function_">createPipeline</span>(reverse, toInt, multiply);
<span class="hljs-keyword">const</span> output = <span class="hljs-title function_">pipeline</span>(<span class="hljs-string">&quot;524&quot;</span>, { <span class="hljs-attr">radix</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">multiplicand</span>: <span class="hljs-number">5</span> });</code>
</figure>

  <p>This snippet declares that a pipeline is a list of functions in the form <code>Array&lt;(input: Input, config: Config) =&gt; Output&gt;</code>.
    Then, it defines what makes a pipeline valid:
  </p>

  <p>A pipeline with only one stage is always valid.
    A longer pipeline is only valid if:
  </p>

  <ul><li>The output type of the first stage is the input type of the second stage <strong>and</strong></li>
    <li>The pipeline consisting of all stages except the first is valid</li></ul>

  <p>That&#39;s right, a recursive conditional type definition!
    If the pipeline is 10 stages long, we end up with a 10-layer nested type:
  </p>

  <figure><img src="/assets/blog/typescript-builders/Builders-Varaidic.svg" title="Recursive type definitions are a bit of a trip" alt="Shows the full recursive type checking of a pipeline" class="svelte-1wsp3u5"></figure>

  <hr>

  <p>It goes without saying that you probably shouldn&#39;t do this without good reason.
    The <code>createPipeline</code> method signature, with 238 characters on one line, is probably enough evidence of that.
  </p>

  <p>If you do have a good reason to do this though, hooray!
    It&#39;s finally possible.
    Look how nice that <code>createPipeline</code> call is!
  </p>

  <p>I&#39;m really excited about variadic tuple types, so keep an eye out for a future blog post on that topic.
  </p>

  <h2>Conclusion</h2>

  <p>We&#39;ve introduced the idea of a pipeline, and discussed how it&#39;s really hard to achieve type soundness in a pipeline factory function.
    Builders came in to save the day, introducing us to Mutable Generic State.
  </p>

  <p>We used the pipeline as a worked example, establishing what generic types the builder would need.
    Our builders couldn&#39;t enforce the complex constraints on the state directly, so we set up our methods to prevent the internal state becoming invalid.
  </p>

  <p>Finally, we discussed the issues with using the builder pattern, and ended with a bang courtesy of variadic tuple types.
  </p>

  <p>Next time you find yourself cursing a type definition that&#39;s <strong>just not narrow enough</strong>, I hope your newfound builder knowledge is useful!
  </p>

  <hr>

  <p>If you made it this far, congrats.
    This is the longest blog post I&#39;ve ever written, by a large margin, and it&#39;s taken me 6 months to finish.
  </p>

  <p>I really hope you enjoyed it, and I hope you found it useful.
    Feel free to contact me on <a href="https://twitter.com/SteWaterman">Twitter</a> with any questions, feedback, or to point out mistakes!
  </p>

  <hr>

  <p>My follow up post &#39;<a href="/reducer-builder">Better Redux Reducers with TypeScript Builders</a>&#39; is now live.
    It demonstrates how to use the builder pattern we saw in this post to create Redux Reducers.
    If you want a more realistic example of where builders can help in your TypeScript projects, go check it out!
  </p>

					</div></article></div>

		

<div class="textContainer svelte-11sshxl" style="position: sticky; top: 1em;"><div class="authorCol svelte-1ghjldr"><div class="details svelte-1ghjldr"><img src="/assets/blog/authors/SteWaterman.jpg" alt="Steven Waterman" class="svelte-1ghjldr">
			<h2 class="name svelte-1ghjldr">Steven Waterman</h2>
			<p class="job svelte-1ghjldr">Over-thinker</p>
			</div>

		

		<ul class="links svelte-1ghjldr"><li class="svelte-1ghjldr"><a href="mailto:blog@stevenwaterman.uk" class="svelte-1ghjldr"><svg id="" class="svelte-fa svelte-1cj2gr0" style="height:1em;vertical-align:-.125em;transform-origin:center;overflow:visible" viewBox="0 0 512 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(256 256)" transform-origin="128 0"><g transform="translate(0,0) scale(1,1)"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z" fill="currentColor" transform="translate(-256 -256)"></path></g></g></svg> <span class="linkText svelte-1ghjldr">blog@stevenwaterman.uk</span></a></li>

			<li class="svelte-1ghjldr"><a href="https://calendly.com/stewaterman/30min" class="svelte-1ghjldr"><svg id="" class="svelte-fa svelte-1cj2gr0" style="height:1em;vertical-align:-.125em;transform-origin:center;overflow:visible" viewBox="0 0 448 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(224 256)" transform-origin="112 0"><g transform="translate(0,0) scale(1,1)"><path d="M436 160H12c-6.627 0-12-5.373-12-12v-36c0-26.51 21.49-48 48-48h48V12c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v52h128V12c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v52h48c26.51 0 48 21.49 48 48v36c0 6.627-5.373 12-12 12zM12 192h424c6.627 0 12 5.373 12 12v260c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V204c0-6.627 5.373-12 12-12zm333.296 95.947l-28.169-28.398c-4.667-4.705-12.265-4.736-16.97-.068L194.12 364.665l-45.98-46.352c-4.667-4.705-12.266-4.736-16.971-.068l-28.397 28.17c-4.705 4.667-4.736 12.265-.068 16.97l82.601 83.269c4.667 4.705 12.265 4.736 16.97.068l142.953-141.805c4.705-4.667 4.736-12.265.068-16.97z" fill="currentColor" transform="translate(-224 -256)"></path></g></g></svg> <span class="linkText svelte-1ghjldr">Office Hours</span></a></li>

			<li class="svelte-1ghjldr"><a href="https://github.com/StevenWaterman/" class="svelte-1ghjldr"><svg id="" class="svelte-fa svelte-1cj2gr0" style="height:1em;vertical-align:-.125em;transform-origin:center;overflow:visible" viewBox="0 0 496 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(248 256)" transform-origin="124 0"><g transform="translate(0,0) scale(1,1)"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" fill="currentColor" transform="translate(-248 -256)"></path></g></g></svg> <span class="linkText svelte-1ghjldr">@StevenWaterman</span></a></li>

			<li class="svelte-1ghjldr"><a href="https://twitter.com/SteWaterman/" class="svelte-1ghjldr"><svg id="" class="svelte-fa svelte-1cj2gr0" style="height:1em;vertical-align:-.125em;transform-origin:center;overflow:visible" viewBox="0 0 512 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(256 256)" transform-origin="128 0"><g transform="translate(0,0) scale(1,1)"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" fill="currentColor" transform="translate(-256 -256)"></path></g></g></svg> <span class="linkText svelte-1ghjldr">@SteWaterman</span></a></li>

			<li class="svelte-1ghjldr"><a href="https://twitch.tv/SteWaterman/" class="svelte-1ghjldr"><svg id="" class="svelte-fa svelte-1cj2gr0" style="height:1em;vertical-align:-.125em;transform-origin:center;overflow:visible" viewBox="0 0 512 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(256 256)" transform-origin="128 0"><g transform="translate(0,0) scale(1,1)"><path d="M391.17,103.47H352.54v109.7h38.63ZM285,103H246.37V212.75H285ZM120.83,0,24.31,91.42V420.58H140.14V512l96.53-91.42h77.25L487.69,256V0ZM449.07,237.75l-77.22,73.12H294.61l-67.6,64v-64H140.14V36.58H449.07Z" fill="currentColor" transform="translate(-256 -256)"></path></g></g></svg> <span class="linkText svelte-1ghjldr">@SteWaterman</span></a></li>

			<li class="svelte-1ghjldr"><a href="https://www.linkedin.com/in/steven-waterman/" class="svelte-1ghjldr"><svg id="" class="svelte-fa svelte-1cj2gr0" style="height:1em;vertical-align:-.125em;transform-origin:center;overflow:visible" viewBox="0 0 448 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(224 256)" transform-origin="112 0"><g transform="translate(0,0) scale(1,1)"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z" fill="currentColor" transform="translate(-224 -256)"></path></g></g></svg> <span class="linkText svelte-1ghjldr">@steven-waterman</span></a></li>

			</ul></div></div></div></div>




	</body>
</html>
